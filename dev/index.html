<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Fits multispecies site occupancy models to environmental DNA
    metabarcoding data collected using spatially-replicated survey design.
    Model fitting results can be used to evaluate and compare the effectiveness
    of species detection to find an efficient survey design.">
<title>Site Occupancy Modeling For Environmental DNA Metabarcoding â€¢ occumb</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Site Occupancy Modeling For Environmental DNA Metabarcoding">
<meta property="og:description" content="Fits multispecies site occupancy models to environmental DNA
    metabarcoding data collected using spatially-replicated survey design.
    Model fitting results can be used to evaluate and compare the effectiveness
    of species detection to find an efficient survey design.">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">occumb</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.5.1.9005</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="occumb-site-occupancy-modeling-for-environmental-dna-metabarcoding">occumb: Site Occupancy Modeling For Environmental DNA Metabarcoding<a class="anchor" aria-label="anchor" href="#occumb-site-occupancy-modeling-for-environmental-dna-metabarcoding"></a>
</h1></div>
<!-- badges: start -->

<p>occumb is an R package that provides functionalities to apply <a href="https://doi.org/10.1111/2041-210X.13732" class="external-link">the multispecies site occupancy modeling for environmental DNA (eDNA) metabarcoding</a> easily.</p>
<p>This package allows the users to fit the model with a fully Bayesian approach, using the conventional formulas in R. It enables the analysis of the detectability of species in different stages of the workflow of eDNA metabarcoding and inference of species site occupancy while accounting for false negatives. It also provides the functionality for a model-based inference to assist the optimization of the study design.</p>
<p>See the <a href="https://doi.org/10.1111/2041-210X.13732" class="external-link">original paper</a> for details of the model and inference.</p>
<div class="section level2">
<h2 id="important-note">Important note<a class="anchor" aria-label="anchor" href="#important-note"></a>
</h2>
<p>The current programs are an alpha version released to present the concept of package development. In other words, please be aware of the following points when you want to try this package:</p>
<ul>
<li>Some of the planned features have not yet been implemented.</li>
<li>The functions may not have been thoroughly tested.</li>
<li>Documentation may be insufficient.</li>
<li>Specifications may change significantly in the future.</li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Because occumb relies on JAGS to run MCMC, you need first install it following the instructions on the <a href="https://mcmc-jags.sourceforge.io/" class="external-link">JAGS homepage</a>.</p>
<p>You can then install the latest version of occumb from the GitHub repository using the <code>install_github()</code> function in the <a href="https://github.com/r-lib/remotes" class="external-link">remotes</a> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"fukayak/occumb"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>The current version (v0.5.x) provides the following main functions:</p>
<ul>
<li>
<code><a href="reference/occumbData.html">occumbData()</a></code> builds a dataset object used for the multispecies site occupancy modeling.</li>
<li>
<code><a href="reference/occumb.html">occumb()</a></code> fits a model, possibly with species, site, and replicate covariates.</li>
<li>
<code><a href="reference/gof.html">gof()</a></code> computes statistics for goodness-of-fit assessment of the model.</li>
<li>
<code><a href="reference/loglik.html">loglik()</a></code> extracts the pointwise log-likelihood of the model.</li>
<li>
<code><a href="reference/get_posterior.html">get_post_samples()</a></code> and <code>get_post_summary</code> extract posterior samples and summary of parameters from a model-fit object, respectively.</li>
<li>
<code><a href="reference/eval_util_L.html">eval_util_L()</a></code> and <code><a href="reference/eval_util_R.html">eval_util_R()</a></code> predict expected utility (the expected number of detected species) at the local and regional scales, respectively.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fukayak.github.io/occumb/">occumb</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate the smallest random dataset (2 species * 2 sites * 2 reps)</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># Number of species</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># Number of sites</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># Number of replicates</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumbData.html">occumbData</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">I</span> <span class="op">*</span> <span class="va">J</span> <span class="op">*</span> <span class="va">K</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">I</span>, <span class="va">J</span>, <span class="va">K</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    spec_cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cov1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    site_cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cov2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span>,</span>
<span>                    cov3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    repl_cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cov4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">J</span> <span class="op">*</span> <span class="va">K</span><span class="op">)</span>, <span class="va">J</span>, <span class="va">K</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fitting a null model (includes only species-specific intercepts)</span></span>
<span><span class="va">res0</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumb.html">occumb</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># occumb() fits the model using jags() in the jagsUI package.</span></span>
<span><span class="co"># You can thus get the same output as seen in the jagsUI results:</span></span>
<span><span class="va">res0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You can also extract posterior samples and posterior summaries of</span></span>
<span><span class="co"># specific parameters.</span></span>
<span><span class="co"># For example, the following lines get samples and summary for the</span></span>
<span><span class="co"># species site occupancy z:</span></span>
<span><span class="va">post_samples_z</span>  <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_posterior.html">get_post_samples</a></span><span class="op">(</span><span class="va">res0</span>, <span class="st">"z"</span><span class="op">)</span></span>
<span><span class="va">post_summary_z</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_posterior.html">get_post_summary</a></span><span class="op">(</span><span class="va">res0</span>, <span class="st">"z"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add species-specific effects of site covariates in occupancy probabilities</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumb.html">occumb</a></span><span class="op">(</span>formula_psi <span class="op">=</span> <span class="op">~</span> <span class="va">cov2</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>        <span class="co"># Continuous covariate</span></span>
<span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumb.html">occumb</a></span><span class="op">(</span>formula_psi <span class="op">=</span> <span class="op">~</span> <span class="va">cov3</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>        <span class="co"># Categorical covariate</span></span>
<span><span class="va">res3</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumb.html">occumb</a></span><span class="op">(</span>formula_psi <span class="op">=</span> <span class="op">~</span> <span class="va">cov2</span> <span class="op">*</span> <span class="va">cov3</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="co"># Interaction</span></span>
<span></span>
<span><span class="co"># Add species covariate in the three parameters</span></span>
<span><span class="co"># Note that species covariates are modeled as common effects</span></span>
<span><span class="va">res4</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumb.html">occumb</a></span><span class="op">(</span>formula_phi_shared <span class="op">=</span> <span class="op">~</span> <span class="va">cov1</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>   <span class="co"># phi</span></span>
<span><span class="va">res5</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumb.html">occumb</a></span><span class="op">(</span>formula_theta_shared <span class="op">=</span> <span class="op">~</span> <span class="va">cov1</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="co"># theta</span></span>
<span><span class="va">res6</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumb.html">occumb</a></span><span class="op">(</span>formula_psi_shared <span class="op">=</span> <span class="op">~</span> <span class="va">cov1</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>   <span class="co"># psi</span></span>
<span></span>
<span><span class="co"># Add replicate covariates</span></span>
<span><span class="co"># Note that replicate covariates can only be specified for theta and phi</span></span>
<span><span class="va">res7</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumb.html">occumb</a></span><span class="op">(</span>formula_phi <span class="op">=</span> <span class="op">~</span> <span class="va">cov4</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>   <span class="co"># phi</span></span>
<span><span class="va">res8</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumb.html">occumb</a></span><span class="op">(</span>formula_theta <span class="op">=</span> <span class="op">~</span> <span class="va">cov4</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="co"># theta</span></span>
<span></span>
<span><span class="co"># Specify the prior distribution and MCMC settings explicitly</span></span>
<span><span class="va">res9</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumb.html">occumb</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, prior_prec <span class="op">=</span> <span class="fl">1E-2</span>, prior_ulim <span class="op">=</span> <span class="fl">1E2</span>,</span>
<span>               n.chains <span class="op">=</span> <span class="fl">1</span>, n.burnin <span class="op">=</span> <span class="fl">1000</span>, n.thin <span class="op">=</span> <span class="fl">1</span>, n.iter <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">res10</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/occumb.html">occumb</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Run MCMC in parallel</span></span>
<span></span>
<span><span class="co"># Calculate goodness-of-fit statistics</span></span>
<span><span class="va">gof_res0</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gof.html">gof</a></span><span class="op">(</span><span class="va">res0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract pointwise log-likelihood</span></span>
<span><span class="va">ll_res0</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/loglik.html">loglik</a></span><span class="op">(</span><span class="va">res0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate expected utility for local species diversity assessment</span></span>
<span><span class="va">util_L</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/eval_util_L.html">eval_util_L</a></span><span class="op">(</span><span class="fu"><a href="reference/list_cond_L.html">list_cond_L</a></span><span class="op">(</span>budget <span class="op">=</span> <span class="fl">1E5</span>, lambda1 <span class="op">=</span> <span class="fl">0.01</span>, lambda2 <span class="op">=</span> <span class="fl">5000</span>, <span class="va">res0</span><span class="op">)</span>,</span>
<span>                      <span class="va">res0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate expected utility for regional species diversity assessment</span></span>
<span><span class="va">util_R</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/eval_util_R.html">eval_util_R</a></span><span class="op">(</span><span class="fu"><a href="reference/list_cond_R.html">list_cond_R</a></span><span class="op">(</span>budget <span class="op">=</span> <span class="fl">50000</span>,</span>
<span>                                  lambda1 <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                                  lambda2 <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>                                  lambda3 <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span>,</span>
<span>                      <span class="va">res0</span><span class="op">)</span></span></code></pre></div>
<p>See the documentation of each function for more details.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing occumb</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Keiichi Fukaya <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/fukayak/occumb/actions" class="external-link"><img src="https://github.com/fukayak/occumb/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Keiichi Fukaya.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
